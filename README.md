# cat-github-watcher

**PR monitoring tool for the automated implementation phase by GitHub Copilot**

<p align="left">
  <a href="README.ja.md"><img src="https://img.shields.io/badge/üáØüáµ-Japanese-red.svg" alt="Japanese"></a>
  <a href="README.md"><img src="https://img.shields.io/badge/üá∫üá∏-English-blue.svg" alt="English"></a>
</p>

*Note: This document is largely AI-generated. It was generated by feeding an issue to an agent.*

## Situation
- Currently dogfooding.
- Major bugs have been addressed.
- Frequent breaking changes are expected.
- Memo
  - Initially, implementation was attempted with GitHub Actions, but it proved unsuitable for PR monitoring, so we transitioned to a Python version.
  - The Python version monitors user-owned repositories of authenticated GitHub users and performs notifications and actions based on the PR's phase.

## Quick Links
| Item | Link |
|------|--------|
| üìä GitHub Repository | [cat2151/cat-github-watcher](https://github.com/cat2151/cat-github-watcher) |

## Overview

This is a Python tool that monitors the phases of PRs where GitHub Copilot performs automated implementation, executing appropriate notifications and actions at the right time.
It efficiently monitors PRs using the GraphQL API, targeting user-owned repositories of authenticated GitHub users.

## Features

- **Automated All-Repository Monitoring**: Automatically monitors PRs in user-owned repositories of authenticated GitHub users.
- **GraphQL API Utilization**: Achieves fast monitoring through efficient data retrieval.
- **Phase Detection**: Automatically determines PR status (phase1: Draft state, phase2: Addressing review comments, phase3: Awaiting review, LLM working: Coding agent in progress).
- **Automatic Comment Posting**: Automatically posts appropriate comments based on the phase.
- **Automated Draft PR Readying**: Automatically changes Draft PRs to a Ready state for addressing review comments in phase2.
- **Mobile Notifications**: Notifies mobile devices via ntfy.sh when phase3 (awaiting review) is detected.
- **Issue List Display**: If all PRs are "LLM working", displays the top 10 issues from repositories with no open PRs.

## Architecture

This tool is a Python application modularized according to the Single Responsibility Principle (SRP).

### Directory Structure

```
cat-github-watcher/
‚îú‚îÄ‚îÄ cat-github-watcher.py    # Entry point
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îî‚îÄ‚îÄ gh_pr_phase_monitor/
‚îÇ       ‚îú‚îÄ‚îÄ colors.py         # ANSI color codes and coloring
‚îÇ       ‚îú‚îÄ‚îÄ config.py         # Configuration loading and parsing
‚îÇ       ‚îú‚îÄ‚îÄ github_client.py  # GitHub API integration
‚îÇ       ‚îú‚îÄ‚îÄ phase_detector.py # PR phase detection logic
‚îÇ       ‚îú‚îÄ‚îÄ comment_manager.py # Comment posting and verification
‚îÇ       ‚îú‚îÄ‚îÄ pr_actions.py     # PR actions (Readying, browser launch)
‚îÇ       ‚îî‚îÄ‚îÄ main.py           # Main execution loop
‚îî‚îÄ‚îÄ tests/                    # Test files
```

### Phase Detection Logic

The tool detects the following four phases:

1. **phase1 (Draft State)**: When a PR is in Draft state and has review requests.
2. **phase2 (Addressing Review Comments)**: When `copilot-pull-request-reviewer` has posted review comments and corrections are needed.
3. **phase3 (Awaiting Review)**: When `copilot-swe-agent` has completed corrections and is awaiting human review.
4. **LLM working (Coding Agent in Progress)**: When none of the above apply (e.g., Copilot is implementing).

## Usage

### Prerequisites

- Python 3.x is installed.
- GitHub CLI (`gh`) is installed and authenticated.
  ```bash
  gh auth login
  ```

### Setup

1. Clone this repository:
   ```bash
   git clone https://github.com/cat2151/cat-github-watcher.git
   cd cat-github-watcher
   ```

2. Create a configuration file (optional):
   ```bash
   cp config.toml.example config.toml
   ```

3. Edit `config.toml` to configure monitoring interval, ntfy.sh notifications, and Copilot auto-assignment (optional):
   ```toml
   # Check interval (e.g., "30s", "1m", "5m", "1h", "1d")
   interval = "1m"
   
   # ntfy.sh notification settings (optional)
   # Notifications include a clickable action button to open the PR
   [ntfy]
   enabled = false  # Set to true to enable notifications
   topic = "<Enter your ntfy.sh topic name here>"  # This topic is readable/writable by anyone, so use an unguessable string
   message = "PR is ready for review: {url}"  # Message template
   priority = 4  # Notification priority (1=lowest, 3=default, 4=high, 5=highest)
   
   # Auto-assign "good first issue" issues to Copilot (optional)
   # If enabled, it will open the issue in a browser and prompt you to click the "Assign to Copilot" button.
   # If automated = true, it will automatically click the button via browser automation (requires Selenium).
   [assign_to_copilot]
   enabled = false  # Set to true to enable auto-assignment functionality
   automated = false  # Set to true to enable browser automation (requires: pip install selenium webdriver-manager)
   wait_seconds = 10  # Waiting time in seconds after browser launch, before clicking the button
   browser = "edge"  # Browser to use ("edge", "chrome", "firefox")
   ```

4. (Optional) If you plan to use browser automation, install Selenium:
   ```bash
   pip install -r requirements-automation.txt
   ```
   or
   ```bash
   pip install selenium webdriver-manager
   ```
   
   Additionally, you will need the driver for your chosen browser:
   - **Edge**: Built-in on Windows 10/11 (no additional installation required)
   - **Chrome**: ChromeDriver will be downloaded automatically
   - **Firefox**: GeckoDriver will be downloaded automatically
   ```

### Run

Start the tool to begin monitoring:

```bash
python3 cat-github-watcher.py [config.toml]
```

Or, run directly as a Python module:

```bash
python3 -m src.gh_pr_phase_monitor.main [config.toml]
```

### Operation Flow

1. **Startup**: When the tool starts, it begins monitoring user-owned repositories of authenticated GitHub users.
2. **PR Detection**: Automatically detects repositories with open PRs.
3. **Phase Determination**: Determines the phase of each PR (phase1/2/3, LLM working).
4. **Action Execution**:
   - **phase1**: No action (awaits in Draft state).
   - **phase2**: Changes Draft PRs to a Ready state and posts a comment requesting Copilot to apply changes.
   - **phase3**: Notifies of awaiting review (mobile notification if ntfy.sh is configured, opens PR page in browser).
   - **LLM working**: Awaits (if all PRs are in this state, displays issues from repositories with no open PRs).
5. **Repeat**: Continues monitoring at the configured interval.

### Stopping

You can stop monitoring by pressing `Ctrl+C`.

## Important Notes

- GitHub CLI (`gh`) must be installed and authenticated.
- This tool assumes integration with GitHub Copilot (specifically `copilot-pull-request-reviewer` and `copilot-swe-agent`).
- Only **user-owned repositories** of the authenticated user are monitored. Organization repositories are not included to keep the tool simple and focused (YAGNI principle).
- Be mindful of API rate limits, as this tool uses the GraphQL API.
- If using ntfy.sh notifications, configure your topic on [ntfy.sh](https://ntfy.sh/) beforehand.

## Testing

The project includes a test suite using pytest:

```bash
pytest tests/
```

## License

MIT License - See the LICENSE file for details.

*Note: The English README.md is automatically generated from README.ja.md via Gemini's translation using GitHub Actions.*

*Big Brother is watching your repositories. Now it‚Äôs the cat.* üê±